name: Automated Data Preprocessing CI

# Trigger: Kapan workflow ini akan berjalan
on:
  # Berjalan setiap kali ada 'push' ke branch 'main'
  push:
    branches: [ "main" ]
  
  # bisa menjalankan workflow ini secara manual dari tab Actions
  workflow_dispatch:

# Daftar pekerjaan (jobs) yang akan dieksekusi
jobs:
  # satu job: 'preprocess'
  preprocess:
    # Menggunakan OS Ubuntu versi terbaru
    runs-on: ubuntu-latest

    # Langkah-langkah yang akan dijalankan
    steps:
      # 1. Mengunduh (checkout) kode repository Anda ke server GitHub
      - name: Check out repository
        uses: actions/checkout@v4

      # 2. Menyiapkan environment Python
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.10' 

      # 3. Meng-install dependencies dari file requirements.txt
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt

      # 4. Menjalankan script preprocessing 
      - name: Run preprocessing script
        run: |
          python preprocessing/automate_Mohammed-Noeno-Hadianto.py \
            --input "namadataset_raw/netflix_titles.csv" \
            --output "namadataset_preprocessing/netflix_preprocessed.csv"
            
      # 5. Mengunggah hasil preprocessing sebagai artefak
      - name: Upload preprocessed dataset as artifact
        uses: actions/upload-artifact@v4
        with:
          # Nama artefak yang akan muncul di halaman GitHub Actions
          name: preprocessed-dataset
          
          # Path ke file yang ingin diunggah
          path: namadataset_preprocessing/netflix_preprocessed.csv
